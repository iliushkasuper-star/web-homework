#include <iostream>
#include <fstream>
#include <thread>
#include <vector>
#include <mutex>
using namespace std;

mutex logMutex;

void writeLog(int threadId, int M) {
    for (int i = 1; i <= M; i++) {
   lock_guard<std::mutex> lock(logMutex);
        

   ofstream log("log.txt", std::ios::app);
        log << "Поток " << threadId << " записал сообщение " << i << std::endl;
    }
}

int main() {
    int N = 5; 
    int M = 3; 

vector<std::thread> threads;

    for (int i = 0; i < N; i++) {
        threads.emplace_back(writeLog, i + 1, M);
    }

    for (auto& t : threads) {
        t.join();
    }

cout << "Finished work." << std::endl;
cout << "All logs record:  " << N * M << std::endl;

    return 0;
} 
